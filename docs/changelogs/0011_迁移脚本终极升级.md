# 变更日志: 迁移脚本终极升级
**日期**: 2025-11-27 10:00
**任务**: 按照用户指示完善 MongoDB 到 PostgreSQL 的全量迁移脚本

## 📂 文件变更
### 修改 (Modified)
- `scripts/migrate-data.ts`: 引入设置迁移、人员与采摘记录幂等 upsert、以及基于 legacyId 的 UUID 转换等改动。

### 新增 (Created)
- `docs/changelogs/0011_迁移脚本终极升级.md`: 记录本次迁移脚本升级内容。

### 删除 (Deleted)
- 无

## 💡 技术说明 (Technical Notes)
- 使用 uuidv5 为 Mongo `_id` 生成稳定 UUID，确保 `harvest_records` 等缺少唯一字段的集合可以通过 `upsert` 幂等迁移。
- 为 `settings` 集合新增迁移逻辑，自动规范化分类与数据类型枚举，杜绝落地页背景、页脚配置缺失。
- 全面替换剩余 `create`/`update` 调用为 `upsert`，避免脚本重复执行产生脏数据。

