# 变更日志: 模板中心功能补全
**日期**: 2025-11-26 00:00
**任务**: 基于最新模板中心蓝图补充 PostgreSQL 与 Prisma 实现，完善相关 API 行为

## 📂 文件变更
### 修改 (Modified)
- `prisma/schema.prisma`: 为人员、等级、天气、标题模板、鉴赏模板等模型补充唯一约束与索引，使之更贴合模板中心蓝图中的索引设计。
- `src/controllers/templateController.ts`: 调整制作步骤模板列表排序逻辑，按业务预设顺序（摊晾→杀青→揉捻→干燥→分拣）返回数据。
- `src/controllers/managementController.ts`: 
  - 人员管理接口兼容中文角色与枚举值（记录人 / 采摘队长 / 制茶师），并对经验年限做 0–100 的边界约束。
  - 云养茶园领养方案接口修正 `type` 参数到 Prisma 枚举的映射，确保 `private / enterprise / b2b` 与 `AdoptionPlanType` 正确对应。
- `src/controllers/publicController.ts`: 完善公开领养方案接口的默认数据创建逻辑，保证三类方案在缺失时能自动补齐。

### 新增 (Created)
- `docs/changelogs/0005_模板中心功能补全.md`: 记录本次模板中心相关模型与接口行为的补全情况。

### 删除 (Deleted)
- 无。

## 💡 技术说明 (Technical Notes)
- 人员角色继续使用 Prisma 枚举并通过 `@map` 映射到中文存储值，控制层增加角色映射表，以兼容前端按中文角色调用 API 的旧习惯。
- 领养方案仍采用单表 + JSON 字段承载复杂配置结构，但通过更严格的 `type` 枚举映射和默认数据生成逻辑，保证与蓝图中 “按类型获取/保存方案” 的行为一致。
- 为模板相关表补充的索引主要服务于后台管理与前台公开接口的排序和过滤，不改变现有业务字段结构，可通过后续迁移脚本平滑下发到数据库。


