# 变更日志: 上传静态资源缓存配置优化
**日期**: 2025-01-27
**任务**: 优化 `/uploads/` 目录下静态资源的缓存策略，避免每次请求都重新下载图片，提高前端页面性能

## 📂 文件变更
### 修改 (Modified)
- `src/server.ts`:
  - 为 `/uploads` 静态目录增加 `express.static` 配置，统一设置 `Cache-Control: public, max-age=31536000, immutable`，让浏览器对上传的图片和视频资源进行长期缓存。

## 💡 技术说明 (Technical Notes)
- **问题原因**:
  - 之前直接使用 `app.use('/uploads', express.static(UPLOADS_DIR))`，在某些环境下默认响应头为 `Cache-Control: public, max-age=0, must-revalidate`，导致浏览器每次都重新发起请求，页面内大量图片加载缓慢。
- **修复方案**:
  - 改为：
    - `app.use('/uploads', express.static(UPLOADS_DIR, { setHeaders: (...) }))`
    - 在 `setHeaders` 回调中，如果当前响应还未设置 `Cache-Control`，统一写入 `public, max-age=31536000, immutable`，相当于开启一年期强缓存。
- **影响**:
  - `/uploads/` 下的头像、日记图片、采摘记录照片、批次封面等静态资源，将在首次访问后被浏览器长期缓存，后续访问几乎不再命中网络，大幅降低前端页面的加载时间。
  - 若后续需要更新资源，可以通过文件名带时间戳或 hash 的方式实现“缓存穿透”，不需要修改后端配置。


