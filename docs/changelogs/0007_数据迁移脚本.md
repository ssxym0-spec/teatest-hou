# 变更日志: 数据迁移脚本
**日期**: 2025-11-26 10:00
**任务**: 为旧 MongoDB 到新 PostgreSQL 搭建统一的数据迁移脚本，覆盖用户、品类、地块、模板中心及生长/采摘/批次等核心业务数据。

## 📂 文件变更
### 修改 (Modified)
- 无

### 新增 (Created)
- `scripts/migrate-data.ts`: 新增统一数据迁移脚本，连接 `process.env.OLD_MONGO_URL` 与 PrismaClient，实现 Users、TeaCategory、Plot、模板中心（步骤/标题/鉴赏/天气/人员/等级/领养方案）、DailyGrowthLog、MonthlySummary、Batch、HarvestRecord 等核心模块的迁移，并在内存中维护旧 `_id` 到新 UUID 的映射以保持关键关联关系。
- `docs/changelogs/0007_数据迁移脚本.md`: 记录本次数据迁移脚本的新增与影响范围。

### 删除 (Deleted)
- 无

## 💡 技术说明 (Technical Notes)
- 所有迁移函数均从旧 Mongo 集合中读取文档，将 `_id` 显式转换为字符串用于日志与映射，同时在 PostgreSQL 侧依赖 Prisma 默认 UUID 主键；对于需要外键的场景（如地块与生长日志、人员与日志/采摘/批次、批次与采摘记录），通过内存 Map 维护 `legacyId -> newId` 的映射关系再写入 PG。
- DailyGrowthLog 的 `farm_activity_type` 字段从中文枚举（如“施肥”、“修剪”、“采摘”）映射到 Prisma 中的 `FarmActivityType` 枚举；Batch 的状态从“进行中 / 已完成 / 已发布”映射到 `BatchStatus`。
- HarvestRecord 迁移时会同时更新与 Batch 的多对多关联：若旧记录存在 `assigned_batch_id`，则在 PG 中设置 `assignedBatchId`，并写入 `BatchHarvestRecord` 连接表，保证批次与采摘记录的追溯链路。


