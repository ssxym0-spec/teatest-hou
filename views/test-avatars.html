<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤´åƒæµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 2rem;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #66bb6a;
            margin: 10px;
        }
        .avatar-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .avatar-item {
            text-align: center;
        }
        .error {
            color: red;
        }
        .success {
            color: green;
        }
        pre {
            background: #f0f0f0;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ–¼ï¸ å¤´åƒåŠ è½½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1. ç›´æ¥è®¿é—®å›¾ç‰‡æµ‹è¯•</h2>
        <div class="avatar-container">
            <div class="avatar-item">
                <img src="/uploads/misc/1759679213193-377974612.png" 
                     alt="å¼ å¸ˆå‚…" 
                     class="avatar"
                     onload="console.log('âœ… å¼ å¸ˆå‚…å¤´åƒåŠ è½½æˆåŠŸ')"
                     onerror="console.error('âŒ å¼ å¸ˆå‚…å¤´åƒåŠ è½½å¤±è´¥'); this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Crect fill=%22%23ddd%22 width=%22100%22 height=%22100%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23666%22%3Eé”™è¯¯%3C/text%3E%3C/svg%3E'">
                <div>å¼ å¸ˆå‚…</div>
            </div>
            <div class="avatar-item">
                <img src="/uploads/misc/1759679206625-619413073.png" 
                     alt="å´å¸ˆå‚…" 
                     class="avatar"
                     onload="console.log('âœ… å´å¸ˆå‚…å¤´åƒåŠ è½½æˆåŠŸ')"
                     onerror="console.error('âŒ å´å¸ˆå‚…å¤´åƒåŠ è½½å¤±è´¥'); this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Crect fill=%22%23ddd%22 width=%22100%22 height=%22100%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23666%22%3Eé”™è¯¯%3C/text%3E%3C/svg%3E'">
                <div>å´å¸ˆå‚…</div>
            </div>
            <div class="avatar-item">
                <img src="/uploads/misc/1759679949816-925609911.png" 
                     alt="é™ˆå¤§å¸ˆ" 
                     class="avatar"
                     onload="console.log('âœ… é™ˆå¤§å¸ˆå¤´åƒåŠ è½½æˆåŠŸ')"
                     onerror="console.error('âŒ é™ˆå¤§å¸ˆå¤´åƒåŠ è½½å¤±è´¥'); this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Crect fill=%22%23ddd%22 width=%22100%22 height=%22100%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23666%22%3Eé”™è¯¯%3C/text%3E%3C/svg%3E'">
                <div>é™ˆå¤§å¸ˆï¼ˆåˆ¶èŒ¶å¸ˆï¼‰</div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>2. API æ•°æ®æµ‹è¯•</h2>
        <div id="api-results">åŠ è½½ä¸­...</div>
    </div>

    <div class="test-section">
        <h2>3. åŠ¨æ€æ¸²æŸ“äººå‘˜å¡ç‰‡</h2>
        <div id="person-cards"></div>
    </div>

    <script>
        // æµ‹è¯• API è¿”å›æ•°æ®
        async function testAPI() {
            const resultsDiv = document.getElementById('api-results');
            const cardsDiv = document.getElementById('person-cards');
            
            try {
                // æµ‹è¯•ç”Ÿé•¿æ—¥å¿— API
                const growthResponse = await fetch('/api/public/growth-data?month=2025-10');
                const growthData = await growthResponse.json();
                
                console.log('ç”Ÿé•¿æ—¥å¿—APIè¿”å›:', growthData);
                
                if (growthData.dailyLogs && growthData.dailyLogs.length > 0) {
                    const firstLog = growthData.dailyLogs[0];
                    
                    resultsDiv.innerHTML = `
                        <h3 class="success">âœ… API æ•°æ®æ­£å¸¸</h3>
                        <p><strong>ç¬¬ä¸€æ¡æ—¥å¿—ï¼š</strong></p>
                        <ul>
                            <li>æ—¥æœŸ: ${firstLog.formatted_date}</li>
                            <li>è®°å½•äººå§“å: ${firstLog.recorder_name}</li>
                            <li>recorder_id æ˜¯å¦å­˜åœ¨: ${firstLog.recorder_id ? 'âœ… æ˜¯' : 'âŒ å¦'}</li>
                            ${firstLog.recorder_id ? `
                                <li>recorder_id.name: ${firstLog.recorder_id.name}</li>
                                <li>recorder_id.avatar_url: ${firstLog.recorder_id.avatar_url}</li>
                                <li>recorder_id.role: ${firstLog.recorder_id.role}</li>
                            ` : ''}
                        </ul>
                        <pre>${JSON.stringify(firstLog.recorder_id, null, 2)}</pre>
                    `;
                    
                    // æ¸²æŸ“äººå‘˜å¡ç‰‡
                    if (firstLog.recorder_id) {
                        cardsDiv.innerHTML = renderPersonCard(firstLog.recorder_id, firstLog.recorder_name);
                    }
                } else {
                    resultsDiv.innerHTML = '<p class="error">âŒ æ²¡æœ‰ç”Ÿé•¿æ—¥å¿—æ•°æ®</p>';
                }
                
            } catch (error) {
                console.error('API æµ‹è¯•å¤±è´¥:', error);
                resultsDiv.innerHTML = `<p class="error">âŒ API è¯·æ±‚å¤±è´¥: ${error.message}</p>`;
            }
        }
        
        // äººå‘˜å¡ç‰‡æ¸²æŸ“å‡½æ•°ï¼ˆä¸ example-public-page.html ç›¸åŒï¼‰
        function renderPersonCard(personData, defaultName = 'æœªçŸ¥') {
            if (personData && typeof personData === 'object' && personData.name) {
                return `
                    <div class="person-card" style="display: flex; align-items: center; background: white; border-radius: 10px; padding: 1rem; margin-bottom: 1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                        <img 
                            src="${personData.avatar_url || '/default-avatar.png'}" 
                            alt="${personData.name}"
                            style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; margin-right: 1rem; border: 3px solid #66bb6a;"
                            onerror="console.error('âŒ å¤´åƒåŠ è½½å¤±è´¥:', '${personData.avatar_url}'); this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Crect fill=%22%23ddd%22 width=%22100%22 height=%22100%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23666%22%3E?%3C/text%3E%3C/svg%3E'"
                            onload="console.log('âœ… å¤´åƒåŠ è½½æˆåŠŸ:', '${personData.avatar_url}')"
                        >
                        <div style="flex: 1;">
                            <div style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 0.3rem;">${personData.name}</div>
                            <div style="color: #666; font-size: 0.9rem;">${personData.role || ''}</div>
                            ${personData.experience_years ? `<div style="color: #999; font-size: 0.85rem;">ç»éªŒï¼š${personData.experience_years}å¹´</div>` : ''}
                        </div>
                    </div>
                `;
            } else {
                return `
                    <div class="person-card" style="display: flex; align-items: center; background: white; border-radius: 10px; padding: 1rem; margin-bottom: 1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                        <img 
                            src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Crect fill='%23ddd' width='100' height='100'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' fill='%23666'%3E?%3C/text%3E%3C/svg%3E" 
                            alt="${defaultName}"
                            style="width: 60px; height: 60px; border-radius: 50%; margin-right: 1rem;"
                        >
                        <div style="flex: 1;">
                            <div style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 0.3rem;">${defaultName}</div>
                            <div style="color: #999; font-size: 0.9rem;">æš‚æ— è¯¦ç»†ä¿¡æ¯</div>
                        </div>
                    </div>
                `;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', testAPI);
    </script>
</body>
</html>

