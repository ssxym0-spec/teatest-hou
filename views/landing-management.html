<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è½åœ°é¡µç®¡ç† - åç«¯ç™»å½•ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* èŒ¶æ–‡åŒ–è‰²ç³» */
            --tea-green: #6B8E23;
            --tea-green-light: #8BAF3E;
            --tea-green-dark: #556B2F;
            --tea-brown: #8B7355;
            --tea-cream: #F5F0E8;
            --bg-light: #FAFAF8;
            --border-color: #E5E3DA;
            --text-dark: #2C2C2C;
            --text-medium: #5A5A5A;
            --text-light: #8A8A8A;
            --white: #FFFFFF;
            --success: #52C41A;
            --error: #F5222D;
            --warning: #FAAD14;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: var(--bg-light);
            min-height: 100vh;
            color: var(--text-dark);
        }

        /* ========== Header ========== */
        .header {
            background: var(--white);
            padding: 1rem 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            margin-bottom: 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            justify-self: start;
        }

        .header-center {
            justify-self: center;
        }

        .header h1 {
            color: var(--tea-green);
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-buttons {
            display: flex;
            gap: 0.75rem;
        }

        .nav-btn {
            background: var(--tea-green);
            color: white;
            text-decoration: none;
            padding: 0.5rem 1.25rem;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .nav-btn:hover {
            background: var(--tea-green-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(107, 142, 35, 0.2);
        }

        /* ========== Tab Navigation ========== */
        .tab-navigation {
            background: var(--white);
            border-bottom: 2px solid var(--border-color);
            padding: 0 2rem;
            display: flex;
            gap: 0.5rem;
        }

        .tab-btn {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--text-medium);
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
        }

        .tab-btn:hover {
            color: var(--tea-green);
            background: var(--tea-cream);
        }

        .tab-btn.active {
            color: var(--tea-green);
            border-bottom-color: var(--tea-green);
            font-weight: 600;
        }

        .tab-icon {
            font-size: 1.1rem;
        }

        /* ========== Main Content ========== */
        .main-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ========== Dual Panel Layout (å·¦å³åŒæ ) ========== */
        .dual-panel {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 0;
            min-height: calc(100vh - 140px);
            background: var(--white);
        }

        /* å·¦ä¾§åˆ—è¡¨é¢æ¿ */
        .left-panel {
            background: var(--tea-cream);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            max-height: calc(100vh - 140px);
        }

        .panel-header {
            padding: 1.5rem;
            background: var(--white);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .panel-header h3 {
            font-size: 1.1rem;
            color: var(--text-dark);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
        }

        .btn-primary {
            background: var(--tea-green);
            color: white;
        }

        .btn-primary:hover {
            background: var(--tea-green-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(107, 142, 35, 0.2);
        }

        .btn-secondary {
            background: var(--tea-brown);
            color: white;
        }

        .btn-secondary:hover {
            background: #6D5A45;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: var(--error);
            color: white;
        }

        .btn-danger:hover {
            background: #D4190B;
            transform: translateY(-1px);
        }

        .btn-small {
            padding: 0.35rem 0.75rem;
            font-size: 0.8rem;
        }

        /* åˆ—è¡¨é¡¹å¡ç‰‡ */
        .list-items {
            padding: 1rem;
        }

        .list-item {
            background: var(--white);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
        }

        .list-item:hover {
            border-color: var(--tea-green-light);
            box-shadow: 0 4px 12px rgba(107, 142, 35, 0.1);
            transform: translateX(4px);
        }

        .list-item.active {
            border-color: var(--tea-green);
            background: linear-gradient(to right, #FAFFF5, var(--white));
        }

        .list-item-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .list-item-title {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.95rem;
        }

        .list-item-badge {
            background: var(--tea-green);
            color: white;
            padding: 0.15rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .list-item-meta {
            color: var(--text-light);
            font-size: 0.8rem;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .list-item-preview {
            margin-top: 0.5rem;
            display: flex;
            gap: 0.25rem;
        }

        .preview-image {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1.5rem;
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* å³ä¾§ç¼–è¾‘é¢æ¿ */
        .right-panel {
            background: var(--white);
            overflow-y: auto;
            max-height: calc(100vh - 140px);
        }

        .editor-container {
            padding: 2rem;
            max-width: 900px;
        }

        .editor-header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .editor-title {
            font-size: 1.5rem;
            color: var(--text-dark);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .editor-subtitle {
            color: var(--text-medium);
            font-size: 0.9rem;
        }

        .form-section {
            background: var(--tea-cream);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-section-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--tea-green-dark);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-label {
            display: block;
            color: var(--text-dark);
            font-weight: 500;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1.5px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            background: var(--white);
            color: var(--text-dark);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--tea-green);
            box-shadow: 0 0 0 3px rgba(107, 142, 35, 0.1);
        }

        .form-control:disabled,
        .form-control[readonly] {
            background: #F5F5F5;
            color: var(--text-light);
            cursor: not-allowed;
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .form-help {
            color: var(--text-light);
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }

        /* å›¾ç‰‡ç®¡ç†åŒºåŸŸ */
        .image-manager {
            background: var(--white);
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .image-manager:hover {
            border-color: var(--tea-green);
        }

        .image-preview-large {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            margin-bottom: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .image-placeholder {
            width: 200px;
            height: 150px;
            margin: 0 auto 1rem;
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            font-size: 0.9rem;
            background: var(--tea-cream);
        }

        /* è½®æ’­å›¾åˆ—è¡¨ */
        .carousel-list {
            display: grid;
            gap: 0.75rem;
        }

        .carousel-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--white);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .carousel-item:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .carousel-item img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }

        .carousel-item input {
            flex: 1;
            margin: 0;
        }

        /* ä¿¡æ¯é¡¹ç¼–è¾‘å™¨ */
        .info-item-list {
            display: grid;
            gap: 0.75rem;
        }

        .info-item-editor {
            background: var(--white);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            transition: all 0.3s ease;
        }

        .info-item-editor:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .info-item-row {
            display: grid;
            grid-template-columns: 80px 1fr;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .info-item-row:last-child {
            margin-bottom: 0;
        }

        /* åº•éƒ¨æ“ä½œæ  */
        .editor-footer {
            position: sticky;
            bottom: 0;
            background: var(--white);
            border-top: 2px solid var(--border-color);
            padding: 1.5rem 2rem;
            display: flex;
            gap: 1rem;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.04);
        }

        /* å•é¢æ¿å¸ƒå±€ï¼ˆç”¨äºèƒŒæ™¯å›¾å’Œé¡µè„šï¼‰ */
        .single-panel {
            background: var(--white);
            min-height: calc(100vh - 140px);
        }

        .single-panel-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* çŠ¶æ€æç¤º */
        .alert {
            padding: 1rem 1.25rem;
            border-radius: 6px;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .alert-success {
            background: #F6FFED;
            border: 1px solid #B7EB8F;
            color: #389E0D;
        }

        .alert-error {
            background: #FFF1F0;
            border: 1px solid #FFCCC7;
            color: #CF1322;
        }

        .alert-loading {
            background: #E6F7FF;
            border: 1px solid #91D5FF;
            color: #096DD9;
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--tea-green);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ç¤¾äº¤é“¾æ¥åˆ—è¡¨ */
        .social-link-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--white);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-bottom: 0.5rem;
        }

        .social-platform {
            min-width: 80px;
            font-weight: 600;
            color: var(--tea-green);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1024px) {
            .dual-panel {
                grid-template-columns: 280px 1fr;
            }

            .editor-container {
                padding: 1.5rem;
            }

            .info-item-row {
                grid-template-columns: 1fr !important;
            }
        }

        @media (max-width: 768px) {
            /* Header ä¼˜åŒ– */
            .header {
                padding: 1rem;
                display: flex;
                flex-direction: column;
                align-items: stretch;
                gap: 0.75rem;
                position: relative;
            }

            .header-left {
                order: 2;
                flex-direction: column;
                align-items: stretch;
                gap: 0.5rem;
            }

            .header-center {
                order: 1;
            }

            .header h1 {
                font-size: 1.25rem;
                justify-content: center;
            }

            .nav-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }

            .nav-btn {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
                text-align: center;
            }

            /* Tab å¯¼èˆªä¼˜åŒ– */
            .tab-navigation {
                padding: 0 0.25rem;
                gap: 0;
                justify-content: space-between;
                overflow-x: visible;
            }

            .tab-btn {
                padding: 0.6rem 0.4rem;
                font-size: 0.75rem;
                flex: 1;
                min-width: 0;
                justify-content: center;
                white-space: nowrap;
                gap: 0.3rem;
            }

            .tab-icon {
                font-size: 0.95rem;
            }

            /* TabæŒ‰é’®æ–‡å­—æ¢è¡Œå¤„ç† */
            .tab-btn span:not(.tab-icon) {
                overflow: hidden;
                text-overflow: ellipsis;
            }

            /* ä¸­ç­‰æ‰‹æœºå±å¹•ä¼˜åŒ– (375px-480px) */
            @media (max-width: 480px) {
                .tab-btn {
                    padding: 0.55rem 0.3rem;
                    font-size: 0.72rem;
                }

                .tab-icon {
                    font-size: 0.9rem;
                }
            }

            /* åŒæ å¸ƒå±€æ”¹ä¸ºå•æ  */
            .dual-panel {
                grid-template-columns: 1fr;
                min-height: auto;
            }

            .left-panel {
                max-height: 400px;
                border-right: none;
                border-bottom: 2px solid var(--border-color);
            }

            .right-panel {
                max-height: none;
            }

            .panel-header {
                padding: 1rem;
            }

            .panel-header h3 {
                font-size: 1rem;
            }

            .list-items {
                padding: 0.75rem;
            }

            .list-item {
                padding: 0.75rem;
                margin-bottom: 0.5rem;
            }

            .list-item-title {
                font-size: 0.9rem;
            }

            .list-item-meta {
                font-size: 0.75rem;
            }

            /* ç¼–è¾‘å™¨ä¼˜åŒ– */
            .editor-container {
                padding: 1rem;
            }

            .editor-header {
                margin-bottom: 1.5rem;
                padding-bottom: 0.75rem;
            }

            .editor-title {
                font-size: 1.2rem;
            }

            .editor-subtitle {
                font-size: 0.85rem;
            }

            /* è¡¨å•ä¼˜åŒ– */
            .form-section {
                padding: 1rem;
                margin-bottom: 1rem;
            }

            .form-section-title {
                font-size: 0.95rem;
                margin-bottom: 0.75rem;
            }

            .form-group {
                margin-bottom: 1rem;
            }

            .form-label {
                font-size: 0.85rem;
                margin-bottom: 0.4rem;
            }

            .form-control {
                padding: 0.6rem;
                font-size: 0.85rem;
            }

            textarea.form-control {
                min-height: 80px;
            }

            .form-help {
                font-size: 0.75rem;
            }

            /* ä¿¡æ¯é¡¹ç¼–è¾‘å™¨ä¼˜åŒ– */
            .info-item-row {
                grid-template-columns: 1fr !important;
                gap: 0.5rem;
                margin-bottom: 0.5rem;
            }

            .info-item-editor {
                padding: 0.75rem;
            }

            /* è½®æ’­å›¾é¡¹ä¼˜åŒ– */
            .carousel-item {
                flex-direction: column;
                align-items: stretch;
                gap: 0.5rem;
                padding: 0.75rem;
            }

            .carousel-item img {
                width: 100%;
                height: auto;
                min-height: 120px;
                max-height: 200px;
                object-fit: cover;
            }

            .carousel-item input {
                width: 100%;
            }

            .carousel-item button {
                width: 100%;
            }

            /* å›¾ç‰‡ç®¡ç†ä¼˜åŒ– */
            .image-manager {
                padding: 1rem;
            }

            .image-preview-large {
                max-height: 200px;
            }

            .image-placeholder {
                width: 100% !important;
                height: 120px !important;
                font-size: 0.85rem;
            }

            /* åº•éƒ¨æ“ä½œæ ä¼˜åŒ– */
            .editor-footer {
                padding: 1rem;
                flex-direction: column;
                gap: 0.75rem;
                position: relative;
            }

            .btn {
                width: 100%;
                justify-content: center;
                padding: 0.7rem 1rem;
                font-size: 0.9rem;
            }

            .btn-small {
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
            }

            /* å•é¢æ¿å†…å®¹ä¼˜åŒ– */
            .single-panel-content {
                padding: 1rem;
            }

            /* ç½‘æ ¼å¸ƒå±€ä¼˜åŒ– */
            .preview-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            /* ç¤¾äº¤é“¾æ¥ä¼˜åŒ– */
            .social-link-item {
                flex-direction: column;
                align-items: stretch;
                gap: 0.5rem;
                padding: 0.75rem;
            }

            .social-platform {
                min-width: auto;
                font-size: 0.9rem;
            }

            /* è¯¦ç»†ä¿¡æ¯è¡¨å•ç½‘æ ¼ä¼˜åŒ– */
            .form-section > div[style*="grid-template-columns: 1fr 1fr"] {
                display: block !important;
            }

            .form-section > div[style*="grid-template-columns: 1fr 1fr"] > .form-group {
                margin-bottom: 1rem;
            }

            /* æ·»åŠ æ–°é“¾æ¥è¡¨å•ä¼˜åŒ– */
            div[style*="grid-template-columns: 1fr 2fr auto"] {
                display: flex !important;
                flex-direction: column !important;
                gap: 0.5rem !important;
            }

            div[style*="grid-template-columns: 1fr 2fr auto"] > div {
                width: 100%;
            }

            /* Alert æç¤ºä¼˜åŒ– */
            .alert {
                padding: 0.75rem 1rem;
                font-size: 0.85rem;
                margin-bottom: 1rem;
            }

            /* ç©ºçŠ¶æ€ä¼˜åŒ– */
            .empty-state {
                padding: 2rem 1rem;
                font-size: 0.9rem;
            }

            .empty-state-icon {
                font-size: 2.5rem;
            }

            /* é¢„è§ˆå¡ç‰‡ä¼˜åŒ– */
            .preview-card {
                padding: 1rem;
                margin-top: 0.75rem;
            }

            .preview-card-title {
                font-size: 0.95rem;
                margin-bottom: 0.75rem;
            }

            .preview-item {
                padding: 0.75rem;
                font-size: 0.8rem;
            }

            /* åŠ¨ä½œæŒ‰é’®ç»„ä¼˜åŒ– */
            .action-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }

            .action-buttons .btn {
                width: 100%;
            }

            /* å›ºå®šå®šä½å…ƒç´ ä¼˜åŒ– */
            body > .alert {
                left: 10px !important;
                right: 10px !important;
                top: 10px !important;
                max-width: calc(100% - 20px) !important;
            }
        }

        /* è¶…å°å±å¹•ä¼˜åŒ– (360pxä»¥ä¸‹) */
        @media (max-width: 360px) {
            .header h1 {
                font-size: 1.1rem;
            }

            .tab-navigation {
                padding: 0 0.15rem;
            }

            .tab-btn {
                padding: 0.5rem 0.25rem;
                font-size: 0.7rem;
                gap: 0.2rem;
            }

            .tab-icon {
                font-size: 0.85rem;
            }

            .editor-title {
                font-size: 1.1rem;
            }

            .form-control {
                font-size: 0.8rem;
            }

            .btn {
                font-size: 0.85rem;
                padding: 0.6rem 0.75rem;
            }

            .list-item {
                padding: 0.6rem;
            }

            .form-section {
                padding: 0.75rem;
            }
        }

        /* å·¥å…·æç¤º */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            background-color: var(--text-dark);
            color: white;
                text-align: center;
            padding: 0.5rem;
            border-radius: 4px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* é¢„è§ˆå¡ç‰‡ */
        .preview-card {
            background: var(--white);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .preview-card-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }

        .preview-item {
            background: var(--tea-cream);
            padding: 1rem;
            border-radius: 6px;
            font-size: 0.85rem;
        }

        .preview-item strong {
            color: var(--tea-green-dark);
            display: block;
            margin-bottom: 0.25rem;
        }

        /* éšè—æ–‡ä»¶è¾“å…¥ */
        input[type="file"] {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <div class="nav-buttons">
                <a href="/dashboard" class="nav-btn">â† è¿”å›ä»ªè¡¨æ¿</a>
                <a href="/" class="nav-btn">ğŸ  è¿”å›é¦–é¡µ</a>
            </div>
        </div>
        <div class="header-center">
            <h1>
                <span>ğŸƒ</span>
                <span>è½åœ°é¡µç®¡ç†ä¸­å¿ƒ</span>
            </h1>
        </div>
        <div></div>
    </header>

    <!-- Tab Navigation -->
    <nav class="tab-navigation">
        <button class="tab-btn active" onclick="switchTab('plots')">
            <span class="tab-icon">ğŸï¸</span>
            <span>åœ°å—ä¿¡æ¯</span>
        </button>
        <button class="tab-btn" onclick="switchTab('categories')">
            <span class="tab-icon">ğŸƒ</span>
            <span>å“ç±»ç®¡ç†</span>
        </button>
        <button class="tab-btn" onclick="switchTab('background')">
            <span class="tab-icon">ğŸ¨</span>
            <span>èƒŒæ™¯å›¾è®¾ç½®</span>
        </button>
        <button class="tab-btn" onclick="switchTab('footer')">
            <span class="tab-icon">ğŸ“„</span>
            <span>é¡µè„šè®¾ç½®</span>
        </button>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Tab 1: åœ°å—ä¿¡æ¯ç®¡ç† -->
        <div id="tab-plots" class="tab-content active">
            <div class="dual-panel">
                <!-- å·¦ä¾§åˆ—è¡¨ -->
                <div class="left-panel">
                    <div class="panel-header">
                        <h3>ğŸ“‹ åœ°å—åˆ—è¡¨</h3>
                        <div class="action-buttons">
                            <button class="btn btn-primary btn-small" onclick="createNewPlot()">
                                â• æ–°å»ºåœ°å—
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="loadPlots()">
                                ğŸ”„ åˆ·æ–°
                        </button>
                    </div>
                </div>
                    <div id="plots-list" class="list-items">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸŒ±</div>
                            <div>æ­£åœ¨åŠ è½½åœ°å—ä¿¡æ¯...</div>
                        </div>
                        </div>
                    </div>

                <!-- å³ä¾§ç¼–è¾‘å™¨ -->
                <div class="right-panel">
                    <div id="plot-editor-empty" class="empty-state" style="padding: 4rem 2rem;">
                        <div class="empty-state-icon">ğŸï¸</div>
                        <div style="font-size: 1.1rem; color: var(--text-medium); margin-bottom: 0.5rem;">
                            é€‰æ‹©æˆ–åˆ›å»ºä¸€ä¸ªåœ°å—å¼€å§‹ç¼–è¾‘
                        </div>
                        <div style="font-size: 0.9rem; color: var(--text-light);">
                            åœ¨å·¦ä¾§åˆ—è¡¨ä¸­ç‚¹å‡»åœ°å—ï¼Œæˆ–ç‚¹å‡»"æ–°å»ºåœ°å—"æŒ‰é’®
                        </div>
                    </div>

                    <div id="plot-editor-content" style="display: none;">
                        <div class="editor-container">
                            <div class="editor-header">
                                <div class="editor-title" id="plot-editor-title">ç¼–è¾‘åœ°å—</div>
                                <div class="editor-subtitle">ç®¡ç†åœ°å—çš„åŸºæœ¬ä¿¡æ¯ã€è½®æ’­å›¾ç‰‡å’Œæ ¸å¿ƒå±æ€§</div>
                            </div>

                            <!-- åŸºæœ¬ä¿¡æ¯ -->
                            <div class="form-section">
                                <div class="form-section-title">ğŸ“ åŸºæœ¬ä¿¡æ¯</div>
                        <div class="form-group">
                                    <label class="form-label">åœ°å—åç§°</label>
                                    <input type="text" id="plot-name" class="form-control" placeholder="ä¾‹ï¼šé¾™äº•èŒ¶å›­AåŒº">
                                </div>
                        </div>

                        <!-- è½®æ’­å›¾ç®¡ç† -->
                            <div class="form-section">
                                <div class="form-section-title">ğŸ–¼ï¸ è½®æ’­å›¾ç®¡ç†</div>
                                <div id="carousel-list" class="carousel-list">
                                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                                </div>
                                <div style="margin-top: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                    <button class="btn btn-secondary btn-small" onclick="addNewCarouselImage()">
                                        ğŸ“· æ·»åŠ å›¾ç‰‡
                                    </button>
                                    <button class="btn btn-secondary btn-small" onclick="capturePhoto()">
                                        ğŸ“¸ æ‹ç…§ä¸Šä¼ 
                                    </button>
                            </div>
                        </div>

                        <!-- æ ¸å¿ƒä¿¡æ¯ç®¡ç† -->
                            <div class="form-section">
                                <div class="form-section-title">â„¹ï¸ æ ¸å¿ƒä¿¡æ¯</div>
                                <div id="info-list" class="info-item-list">
                                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                                </div>
                                <div style="margin-top: 1rem;">
                                    <button class="btn btn-secondary btn-small" onclick="addInfoItem()">
                                        â• æ·»åŠ ä¿¡æ¯é¡¹
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- åº•éƒ¨æ“ä½œæ  -->
                        <div class="editor-footer">
                            <button class="btn btn-primary" onclick="savePlotChanges()">
                                ğŸ’¾ ä¿å­˜æ‰€æœ‰æ›´æ”¹
                            </button>
                            <button class="btn btn-secondary" onclick="resetPlotEditor()">
                                ğŸ”„ é‡ç½®
                            </button>
                            <button class="btn btn-danger" onclick="deletePlot()">
                                ğŸ—‘ï¸ åˆ é™¤åœ°å—
                            </button>
                                </div>
                            </div>
                        </div>
                    </div>

            <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
            <input type="file" id="plot-file-input" accept="image/*">
            <input type="file" id="plot-camera-input" accept="image/*" capture="environment">
        </div>

        <!-- Tab 2: å“ç±»ç®¡ç† -->
        <div id="tab-categories" class="tab-content">
            <div class="dual-panel">
                <!-- å·¦ä¾§åˆ—è¡¨ -->
                <div class="left-panel">
                    <div class="panel-header">
                        <h3>ğŸƒ å“ç±»åˆ—è¡¨</h3>
                        <div class="action-buttons">
                            <button class="btn btn-primary btn-small" onclick="createNewCategory()">
                                â• æ–°å»ºå“ç±»
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="loadCategories()">
                                ğŸ”„ åˆ·æ–°
                            </button>
                        </div>
                    </div>
                    <div id="categories-list" class="list-items">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸŒ±</div>
                            <div>æ­£åœ¨åŠ è½½å“ç±»ä¿¡æ¯...</div>
                    </div>
                </div>
            </div>

                <!-- å³ä¾§ç¼–è¾‘å™¨ -->
                <div class="right-panel">
                    <div id="category-editor-empty" class="empty-state" style="padding: 4rem 2rem;">
                        <div class="empty-state-icon">ğŸƒ</div>
                        <div style="font-size: 1.1rem; color: var(--text-medium); margin-bottom: 0.5rem;">
                            é€‰æ‹©æˆ–åˆ›å»ºä¸€ä¸ªå“ç±»å¼€å§‹ç¼–è¾‘
                    </div>
                        <div style="font-size: 0.9rem; color: var(--text-light);">
                            åœ¨å·¦ä¾§åˆ—è¡¨ä¸­ç‚¹å‡»å“ç±»ï¼Œæˆ–ç‚¹å‡»"æ–°å»ºå“ç±»"æŒ‰é’®
                </div>
                        </div>

                    <div id="category-editor-content" style="display: none;">
                        <div class="editor-container">
                            <div class="editor-header">
                                <div class="editor-title" id="category-editor-title">ç¼–è¾‘å“ç±»</div>
                                <div class="editor-subtitle">ç®¡ç†èŒ¶å¶å“ç±»çš„è¯¦ç»†ä¿¡æ¯</div>
                    </div>

                            <!-- åŸºæœ¬ä¿¡æ¯ -->
                            <div class="form-section">
                                <div class="form-section-title">ğŸ“ åŸºæœ¬ä¿¡æ¯</div>
                        <div class="form-group">
                                    <label class="form-label">å“ç±»åç§°</label>
                                    <input type="text" id="category-name" class="form-control" placeholder="ä¾‹ï¼šè¥¿æ¹–é¾™äº•">
                        </div>
                        <div class="form-group">
                                    <label class="form-label">æ ¸å¿ƒæè¿°</label>
                                    <textarea id="category-description" class="form-control" rows="4" placeholder="è¯·è¾“å…¥å“ç±»çš„æ ¸å¿ƒæè¿°æ–‡æ¡ˆ..."></textarea>
                                    </div>
                                    </div>

                            <!-- å“ç±»å›¾ç‰‡ -->
                            <div class="form-section">
                                <div class="form-section-title">ğŸ–¼ï¸ å“ç±»å›¾ç‰‡</div>
                                <div class="image-manager">
                                    <div id="category-image-preview">
                                        <div class="image-placeholder">æš‚æ— å›¾ç‰‡</div>
                                    </div>
                                    <div style="display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap;">
                                        <button class="btn btn-secondary btn-small" onclick="replaceCategoryImage()">
                                            ğŸ“· ä¸Šä¼ å›¾ç‰‡
                                        </button>
                                        <button class="btn btn-secondary btn-small" onclick="captureCategoryPhoto()">
                                            ğŸ“¸ æ‹ç…§
                                        </button>
                                        <button class="btn btn-danger btn-small" onclick="removeCategoryImage()" id="remove-category-image-btn" style="display: none;">
                                            ğŸ—‘ï¸ åˆ é™¤
                                        </button>
                                </div>
                            </div>
                        </div>

                            <!-- è¯¦ç»†ä¿¡æ¯ -->
                            <div class="form-section">
                                <div class="form-section-title">ğŸ“Š è¯¦ç»†ä¿¡æ¯</div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                                        <label class="form-label">é‡‡æ‘˜æœŸ</label>
                                        <input type="text" id="category-picking" class="form-control" placeholder="ä¾‹ï¼š3æœˆä¸­æ—¬-4æœˆä¸Šæ—¬">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">äº§é‡å æ¯” (%)</label>
                                        <input type="number" id="category-yield" class="form-control" min="0" max="100" step="0.1" placeholder="25.5">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">æ˜¾ç¤ºé¡ºåº</label>
                                    <input type="number" id="category-sort-order" class="form-control" min="0" step="1" placeholder="æ•°å­—è¶Šå°è¶Šé å‰">
                                    <div class="form-help">ğŸ’¡ æç¤ºï¼šæ˜å‰èŒ¶=1ï¼Œé›¨å‰èŒ¶=2ï¼Œæ˜¥èŒ¶=3...</div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">å›¾ç‰‡URLï¼ˆç³»ç»Ÿç”Ÿæˆï¼‰</label>
                                    <input type="text" id="category-image-url" class="form-control" readonly>
                                </div>
                                </div>
                            </div>

                        <!-- åº•éƒ¨æ“ä½œæ  -->
                        <div class="editor-footer">
                            <button class="btn btn-primary" onclick="saveCategoryChanges()">
                                ğŸ’¾ ä¿å­˜æ‰€æœ‰æ›´æ”¹
                            </button>
                            <button class="btn btn-secondary" onclick="resetCategoryEditor()">
                                ğŸ”„ é‡ç½®
                            </button>
                            <button class="btn btn-danger" onclick="deleteCategory()">
                                ğŸ—‘ï¸ åˆ é™¤å“ç±»
                            </button>
                        </div>
                    </div>
                    </div>
                </div>

            <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
            <input type="file" id="category-file-input" accept="image/*">
            <input type="file" id="category-camera-input" accept="image/*" capture="environment">
            </div>

        <!-- Tab 3: äº‘å…»èŒ¶å›­èƒŒæ™¯å›¾ -->
        <div id="tab-background" class="tab-content">
            <div class="single-panel">
                <div class="single-panel-content">
                    <div class="editor-header">
                        <div class="editor-title">ğŸ¨ äº‘å…»èŒ¶å›­èƒŒæ™¯å›¾è®¾ç½®</div>
                        <div class="editor-subtitle">ç®¡ç†CTAåŒºåŸŸçš„èƒŒæ™¯å›¾ç‰‡</div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-title">ğŸ–¼ï¸ èƒŒæ™¯å›¾ç‰‡</div>
                        <div class="image-manager">
                            <div id="cta-background-preview">
                                <div class="image-placeholder" style="width: 100%; height: 200px;">æš‚æ— èƒŒæ™¯å›¾</div>
                            </div>
                            <div style="display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap; margin-top: 1rem;">
                                <button class="btn btn-secondary" onclick="replaceCtaBackground()">
                                    ğŸ“· ä¸Šä¼ èƒŒæ™¯å›¾
                                </button>
                                <button class="btn btn-secondary" onclick="captureCtaBackground()">
                                    ğŸ“¸ æ‹ç…§ä¸Šä¼ 
                                </button>
                                <button class="btn btn-danger" onclick="deleteCtaBackground()" id="delete-cta-bg-btn" style="display: none;">
                                    ğŸ—‘ï¸ åˆ é™¤
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-title">â„¹ï¸ å›¾ç‰‡ä¿¡æ¯</div>
                    <div class="form-group">
                            <label class="form-label">å›¾ç‰‡æè¿°</label>
                        <input type="text" id="setting-description" class="form-control" placeholder="ä¾‹ï¼šç¾ä¸½çš„èŒ¶å›­é£å…‰">
                            <div class="form-help">ğŸ’¡ å»ºè®®å°ºå¯¸ï¼š1920x1080pxï¼Œæ ¼å¼ï¼šJPG/PNG</div>
                    </div>
                    <div class="form-group">
                            <label class="form-label">å›¾ç‰‡URLï¼ˆç³»ç»Ÿç”Ÿæˆï¼‰</label>
                            <input type="text" id="cta-background" class="form-control" readonly>
                    </div>
                    </div>

                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button class="btn btn-primary" onclick="saveCtaBackground()">
                            ğŸ’¾ ä¿å­˜è®¾ç½®
                        </button>
                        <button class="btn btn-secondary" onclick="resetCtaBackground()">
                            ğŸ”„ é‡ç½®æ›´æ”¹
                        </button>
                    </div>
                </div>
            </div>

            <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
            <input type="file" id="cta-file-input" accept="image/*">
            <input type="file" id="cta-camera-input" accept="image/*" capture="environment">
                    </div>

        <!-- Tab 4: é¡µè„šè®¾ç½® -->
        <div id="tab-footer" class="tab-content">
            <div class="single-panel">
                <div class="single-panel-content">
                    <div class="editor-header">
                        <div class="editor-title">ğŸ“„ é¡µè„šå†…å®¹ç»Ÿä¸€ç®¡ç†</div>
                        <div class="editor-subtitle">ç®¡ç†ç½‘ç«™é¡µè„šçš„Logoã€ç‰ˆæƒä¿¡æ¯å’Œç¤¾äº¤é“¾æ¥</div>
                </div>

                    <!-- Logoç®¡ç† -->
                    <div class="form-section">
                        <div class="form-section-title">ğŸ·ï¸ é¡µè„šLogo</div>
                        <div class="image-manager">
                                <div id="footer-logo-preview">
                                <div class="image-placeholder" style="width: 200px; height: 100px;">æš‚æ— Logo</div>
                                </div>
                            <div style="display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap; margin-top: 1rem;">
                                <button class="btn btn-secondary" onclick="uploadFooterLogo()">
                                    ğŸ“· ä¸Šä¼ Logo
                                </button>
                                <button class="btn btn-secondary" onclick="captureFooterLogo()">
                                    ğŸ“¸ æ‹ç…§ä¸Šä¼ 
                                </button>
                                <button class="btn btn-danger" onclick="deleteFooterLogo()" id="delete-footer-logo-btn" style="display: none;">
                                    ğŸ—‘ï¸ åˆ é™¤
                                </button>
                                </div>
                            </div>
                        </div>

                    <!-- åŸºæœ¬ä¿¡æ¯ -->
                    <div class="form-section">
                        <div class="form-section-title">ğŸ“ åŸºæœ¬ä¿¡æ¯</div>
                        <div class="form-group">
                            <label class="form-label">èŒ¶å›­åç§°</label>
                            <input type="text" id="footer-garden-name" class="form-control" placeholder="ä¾‹ï¼šé¾™äº•èŒ¶å›­">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ç‰ˆæƒä¿¡æ¯</label>
                            <input type="text" id="footer-copyright" class="form-control" placeholder="ä¾‹ï¼šÂ© 2024 é¾™äº•èŒ¶å›­. All rights reserved.">
                        </div>
                        </div>

                    <!-- ç¤¾äº¤é“¾æ¥ -->
                    <div class="form-section">
                        <div class="form-section-title">ğŸ”— ç¤¾äº¤åª’ä½“é“¾æ¥</div>
                        <div id="footer-social-links-list" class="info-item-list">
                            <div class="empty-state" style="padding: 2rem;">æš‚æ— ç¤¾äº¤é“¾æ¥</div>
                                </div>
                                
                        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                            <label class="form-label" style="margin-bottom: 0.75rem;">æ·»åŠ æ–°é“¾æ¥</label>
                                    <div style="display: grid; grid-template-columns: 1fr 2fr auto; gap: 0.5rem; align-items: end;">
                                        <div>
                                            <select id="footer-new-platform" class="form-control">
                                                <option value="">é€‰æ‹©å¹³å°...</option>
                                                <option value="weibo">å¾®åš</option>
                                                <option value="xiaohongshu">å°çº¢ä¹¦</option>
                                                <option value="douyin">æŠ–éŸ³</option>
                                                <option value="wechat">å¾®ä¿¡</option>
                                            </select>
                                        </div>
                                        <div>
                                            <input type="url" id="footer-new-url" class="form-control" placeholder="https://...">
                                        </div>
                                        <div>
                                    <button class="btn btn-primary" onclick="addFooterSocialLink()">â• æ·»åŠ </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                    <div style="display: flex; gap: 1rem; margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--tea-green);">
                        <button class="btn btn-primary" style="font-size: 1rem; padding: 0.75rem 2rem;" onclick="saveAllFooterSettings()">
                                ğŸ’¾ ä¿å­˜æ‰€æœ‰é¡µè„šè®¾ç½®
                            </button>
                        <button class="btn btn-secondary" onclick="loadFooterSettings()">
                            ğŸ”„ é‡ç½®æ›´æ”¹
                        </button>
                        </div>

                    <!-- é¢„è§ˆåŒºåŸŸ -->
                    <div id="footer-preview" class="preview-card" style="display: none;">
                        <div class="preview-card-title">ğŸ‘ï¸ å½“å‰è®¾ç½®é¢„è§ˆ</div>
                        <div id="footer-preview-content"></div>
                    </div>
                </div>
            </div>

            <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
            <input type="file" id="footer-logo-file-input" accept="image/*">
            <input type="file" id="footer-logo-camera-input" accept="image/*" capture="environment">
            <input type="hidden" id="footer-logo-url">
        </div>
    </main>

    <script>
        // ==================== å…¨å±€å˜é‡ ====================
        
        // åœ°å—ç®¡ç†
        let currentPlots = [];
        let currentSelectedPlotId = '';
        let currentCarouselImages = [];
        let currentInfoItems = [];
        let currentReplaceImageIndex = null; // ç”¨äºæ ‡è®°å½“å‰è¦æ›¿æ¢çš„å›¾ç‰‡ç´¢å¼•

        // å“ç±»ç®¡ç†
        let currentCategories = [];
        let currentSelectedCategoryId = '';
        let currentCategoryImageUrl = '';

        // èƒŒæ™¯å›¾ç®¡ç†
        let currentCtaBackgroundUrl = '';
        let currentCtaDescription = '';

        // é¡µè„šç®¡ç†
        let currentFooterData = {
            logoUrl: '',
            gardenName: '',
            copyrightText: '',
            socialLinks: []
        };

        // å¹³å°åç§°æ˜ å°„
        const platformNames = {
            'weibo': 'å¾®åš',
            'xiaohongshu': 'å°çº¢ä¹¦',
            'douyin': 'æŠ–éŸ³',
            'wechat': 'å¾®ä¿¡'
        };

        function normalizeLandingCategory(category = {}) {
            const normalizedId = category._id ?? category.id ?? category.category_id ?? category.categoryId ?? null;
            const normalizedImageUrl = category.image_url ?? category.imageUrl ?? '';
            const normalizedPickingPeriod = category.picking_period ?? category.pickingPeriod ?? '';
            const normalizedYield = category.yield_percentage ?? category.yieldPercentage ?? 0;
            const normalizedSortOrder = category.sort_order ?? category.sortOrder ?? 999;
            const normalizedPickingStart = category.picking_start_date ?? category.pickingStartDate ?? null;
            const normalizedPickingEnd = category.picking_end_date ?? category.pickingEndDate ?? null;

            return {
                ...category,
                _id: normalizedId,
                id: normalizedId,
                image_url: normalizedImageUrl,
                imageUrl: normalizedImageUrl,
                picking_period: normalizedPickingPeriod,
                pickingPeriod: normalizedPickingPeriod,
                yield_percentage: typeof normalizedYield === 'number'
                    ? normalizedYield
                    : parseFloat(normalizedYield) || 0,
                yieldPercentage: typeof normalizedYield === 'number'
                    ? normalizedYield
                    : parseFloat(normalizedYield) || 0,
                sort_order: typeof normalizedSortOrder === 'number'
                    ? normalizedSortOrder
                    : parseInt(normalizedSortOrder) || 999,
                sortOrder: typeof normalizedSortOrder === 'number'
                    ? normalizedSortOrder
                    : parseInt(normalizedSortOrder) || 999,
                picking_start_date: normalizedPickingStart,
                pickingStartDate: normalizedPickingStart,
                picking_end_date: normalizedPickingEnd,
                pickingEndDate: normalizedPickingEnd,
                description: category.description ?? '',
                name: category.name ?? ''
            };
        }

        function normalizeLandingCategories(categories = []) {
            return categories.map(normalizeLandingCategory);
        }

        // ==================== é¡µé¢åˆå§‹åŒ– ====================
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('âœ… è½åœ°é¡µç®¡ç†ç³»ç»Ÿåˆå§‹åŒ–ä¸­...');
            
            // åŠ è½½æ‰€æœ‰æ•°æ®
            loadPlots();
            loadCategories();
            loadSettings();
            loadFooterSettings();
            
            // åˆå§‹åŒ–æ–‡ä»¶è¾“å…¥äº‹ä»¶
            initFileInputs();
            
            console.log('âœ… ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
        });

        // ==================== Tabåˆ‡æ¢ ====================
        
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰tabå†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰tabæŒ‰é’®çš„activeçŠ¶æ€
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„tab
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            // æ¿€æ´»å¯¹åº”çš„æŒ‰é’®
            event.target.closest('.tab-btn').classList.add('active');
            
            console.log(`ğŸ”„ åˆ‡æ¢åˆ°æ ‡ç­¾é¡µ: ${tabName}`);
        }

        // ==================== åœ°å—ç®¡ç†å‡½æ•° ====================
        
        async function loadPlots() {
            try {
                showLoadingInList('plots-list', 'æ­£åœ¨åŠ è½½åœ°å—ä¿¡æ¯...');
                
                const response = await fetch('/api/plots');
                const result = await response.json();
                
                if (result.success) {
                    currentPlots = result.data;
                    displayPlotsList(currentPlots);
                    console.log(`âœ… æˆåŠŸåŠ è½½ ${currentPlots.length} ä¸ªåœ°å—`);
                } else {
                    showErrorInList('plots-list', 'åŠ è½½åœ°å—æ•°æ®å¤±è´¥: ' + result.message);
                }
            } catch (error) {
                console.error('åŠ è½½åœ°å—æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯:', error);
                showErrorInList('plots-list', 'åŠ è½½åœ°å—æ•°æ®å¤±è´¥: ' + error.message);
            }
        }

        function displayPlotsList(plots) {
            const container = document.getElementById('plots-list');
            
            if (plots.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <div>æš‚æ— åœ°å—æ•°æ®</div>
                        <div style="font-size: 0.85rem; margin-top: 0.5rem;">ç‚¹å‡»"æ–°å»ºåœ°å—"å¼€å§‹åˆ›å»º</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = plots.map(plot => `
                <div class="list-item ${plot._id === currentSelectedPlotId ? 'active' : ''}" 
                     onclick="selectPlot('${plot._id}')">
                    <div class="list-item-header">
                        <div class="list-item-title">${plot.name}</div>
                        <div class="list-item-badge">${plot.carousel_images.length}</div>
                    </div>
                    <div class="list-item-meta">
                        <div>ğŸ“· ${plot.carousel_images.length} å¼ è½®æ’­å›¾</div>
                        <div>â„¹ï¸ ${plot.info_list.length} ä¸ªä¿¡æ¯é¡¹</div>
                    </div>
                    ${plot.carousel_images.length > 0 ? `
                        <div class="list-item-preview">
                            ${plot.carousel_images.slice(0, 4).map(img => 
                                `<img src="${img}" class="preview-image" alt="é¢„è§ˆ" onerror="this.style.display='none'">`
                            ).join('')}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function selectPlot(plotId) {
            const plot = currentPlots.find(p => p._id === plotId);
            if (!plot) return;

            currentSelectedPlotId = plotId;
            currentCarouselImages = [...plot.carousel_images];
            currentInfoItems = plot.info_list.map(item => ({
                icon: item.icon || '',
                label: item.label || '',
                value: item.value || '',
                sub_value: item.sub_value || ''
            }));

            // æ˜¾ç¤ºç¼–è¾‘å™¨
            document.getElementById('plot-editor-empty').style.display = 'none';
            document.getElementById('plot-editor-content').style.display = 'block';

            // æ›´æ–°æ ‡é¢˜å’Œè¡¨å•
            document.getElementById('plot-editor-title').textContent = `ç¼–è¾‘åœ°å—ï¼š${plot.name}`;
            document.getElementById('plot-name').value = plot.name;

            // æ¸²æŸ“è½®æ’­å›¾å’Œä¿¡æ¯é¡¹
            renderCarouselImages();
            renderInfoItems();
            
            // æ›´æ–°åˆ—è¡¨é«˜äº®
            displayPlotsList(currentPlots);
            
            console.log(`âœ… å·²é€‰æ‹©åœ°å—: ${plot.name}`);
        }

        function renderCarouselImages() {
            const container = document.getElementById('carousel-list');
            
            if (currentCarouselImages.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--text-light);">æš‚æ— è½®æ’­å›¾ç‰‡ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ </div>';
                return;
            }

            container.innerHTML = currentCarouselImages.map((imageUrl, index) => `
                <div class="carousel-item">
                    <img src="${imageUrl}" alt="è½®æ’­å›¾ ${index + 1}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yMCAyMEg0MFY0MEgyMFYyMFoiIGZpbGw9IiNEMUQ1REIiLz4KPC9zdmc+Cg=='">
                    <input type="text" class="form-control" value="${imageUrl}" readonly>
                    <button class="btn btn-secondary btn-small" onclick="replaceCarouselImage(${index})">æ›¿æ¢</button>
                    <button class="btn btn-danger btn-small" onclick="removeCarouselImage(${index})">åˆ é™¤</button>
                </div>
            `).join('');
        }

        function renderInfoItems() {
            const container = document.getElementById('info-list');
            
            if (currentInfoItems.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--text-light);">æš‚æ— ä¿¡æ¯é¡¹ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ </div>';
                return;
            }

            container.innerHTML = currentInfoItems.map((item, index) => `
                <div class="info-item-editor">
                    <div class="info-item-row">
                        <input type="text" class="form-control" value="${item.icon || ''}" 
                                   onchange="updateInfoItem(${index}, 'icon', this.value)" 
                               placeholder="å›¾æ ‡">
                        <input type="text" class="form-control" value="${item.label || ''}" 
                                   onchange="updateInfoItem(${index}, 'label', this.value)" 
                               placeholder="æ ‡ç­¾">
                        </div>
                    <div class="info-item-row" style="grid-template-columns: 1fr;">
                        <input type="text" class="form-control" value="${item.value || ''}" 
                               onchange="updateInfoItem(${index}, 'value', this.value)" 
                               placeholder="å€¼">
                    </div>
                    <div class="info-item-row" style="grid-template-columns: 1fr;">
                        <input type="text" class="form-control" value="${item.sub_value || ''}" 
                               onchange="updateInfoItem(${index}, 'sub_value', this.value)" 
                               placeholder="å‰¯å€¼ï¼ˆå¯é€‰ï¼‰">
                    </div>
                    <button class="btn btn-danger btn-small" onclick="removeInfoItem(${index})" style="width: 100%; margin-top: 0.5rem;">
                        ğŸ—‘ï¸ åˆ é™¤
                    </button>
                </div>
            `).join('');
        }

        function addNewCarouselImage() {
            currentReplaceImageIndex = null; // ç¡®ä¿æ˜¯æ·»åŠ æ¨¡å¼
            document.getElementById('plot-file-input').click();
        }

        function capturePhoto() {
            document.getElementById('plot-camera-input').click();
        }

        function replaceCarouselImage(index) {
            currentReplaceImageIndex = index;
            const fileInput = document.getElementById('plot-file-input');
            fileInput.click();
        }

        function removeCarouselImage(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™å¼ å›¾ç‰‡å—ï¼Ÿ')) {
                currentCarouselImages.splice(index, 1);
                renderCarouselImages();
            }
        }

        async function uploadPlotImage(file, index = null) {
            try {
                const formData = new FormData();
                formData.append('image', file);

                const response = await fetch('/api/upload-image', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    const imageUrl = result.data.fullUrl;
                    
                    if (index !== null) {
                        currentCarouselImages[index] = imageUrl;
                    } else {
                        currentCarouselImages.push(imageUrl);
                    }
                    
                    renderCarouselImages();
                    showSuccessAlert('å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼');
                } else {
                    showErrorAlert('å›¾ç‰‡ä¸Šä¼ å¤±è´¥: ' + result.message);
                }
            } catch (error) {
                console.error('ä¸Šä¼ å›¾ç‰‡æ—¶å‘ç”Ÿé”™è¯¯:', error);
                showErrorAlert('å›¾ç‰‡ä¸Šä¼ å¤±è´¥: ' + error.message);
            }
        }

        function addInfoItem() {
            currentInfoItems.push({
                icon: '',
                label: '',
                value: '',
                sub_value: ''
            });
            renderInfoItems();
        }

        function updateInfoItem(index, field, value) {
            if (currentInfoItems[index]) {
                currentInfoItems[index][field] = value;
            }
        }

        function removeInfoItem(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä¿¡æ¯é¡¹å—ï¼Ÿ')) {
                currentInfoItems.splice(index, 1);
                renderInfoItems();
            }
        }

        async function savePlotChanges() {
            if (!currentSelectedPlotId) {
                alert('è¯·å…ˆé€‰æ‹©è¦ç¼–è¾‘çš„åœ°å—');
                return;
            }

            const name = document.getElementById('plot-name').value.trim();
            if (!name) {
                alert('åœ°å—åç§°ä¸èƒ½ä¸ºç©º');
                return;
            }

            try {
                // ä¿å­˜è½®æ’­å›¾
                await fetch(`/api/plots/${currentSelectedPlotId}/carousel`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ carousel_images: currentCarouselImages })
                });

                // ä¿å­˜æ ¸å¿ƒä¿¡æ¯
                const completeInfoList = currentInfoItems.filter(item => {
                    return item.icon || item.label || item.value || item.sub_value;
                });

                await fetch(`/api/plots/${currentSelectedPlotId}/info`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ info_list: completeInfoList })
                });

                showSuccessAlert('åœ°å—ä¿¡æ¯ä¿å­˜æˆåŠŸï¼');
                await loadPlots();
                selectPlot(currentSelectedPlotId);
            } catch (error) {
                console.error('ä¿å­˜åœ°å—ä¿¡æ¯æ—¶å‘ç”Ÿé”™è¯¯:', error);
                showErrorAlert('ä¿å­˜å¤±è´¥: ' + error.message);
            }
        }

        function resetPlotEditor() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ›´æ”¹å—ï¼Ÿæœªä¿å­˜çš„ä¿®æ”¹å°†ä¸¢å¤±ã€‚')) {
                if (currentSelectedPlotId) {
                    selectPlot(currentSelectedPlotId);
                }
            }
        }

        async function createNewPlot() {
            const name = prompt('è¯·è¾“å…¥æ–°åœ°å—çš„åç§°:');
            if (!name || !name.trim()) return;

            try {
                const response = await fetch('/api/plots', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: name.trim(),
                        carousel_images: [],
                        info_list: []
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showSuccessAlert('æ–°åœ°å—åˆ›å»ºæˆåŠŸï¼');
                    await loadPlots();
                    selectPlot(result.data._id);
                } else {
                    showErrorAlert('åˆ›å»ºåœ°å—å¤±è´¥: ' + result.message);
                }
            } catch (error) {
                console.error('åˆ›å»ºåœ°å—æ—¶å‘ç”Ÿé”™è¯¯:', error);
                showErrorAlert('åˆ›å»ºåœ°å—å¤±è´¥: ' + error.message);
            }
        }

        async function deletePlot() {
            if (!currentSelectedPlotId) {
                alert('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„åœ°å—');
                return;
            }

            const plot = currentPlots.find(p => p._id === currentSelectedPlotId);
            if (!confirm(`ç¡®å®šè¦åˆ é™¤åœ°å—"${plot.name}"å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`)) return;

            try {
                const response = await fetch(`/api/plots/${currentSelectedPlotId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    showSuccessAlert('åœ°å—åˆ é™¤æˆåŠŸï¼');
                    document.getElementById('plot-editor-content').style.display = 'none';
                    document.getElementById('plot-editor-empty').style.display = 'block';
                    currentSelectedPlotId = '';
                    await loadPlots();
                } else {
                    showErrorAlert('åˆ é™¤åœ°å—å¤±è´¥: ' + result.message);
                }
            } catch (error) {
                console.error('åˆ é™¤åœ°å—æ—¶å‘ç”Ÿé”™è¯¯:', error);
                showErrorAlert('åˆ é™¤åœ°å—å¤±è´¥: ' + error.message);
            }
        }

        // ==================== å“ç±»ç®¡ç†å‡½æ•° ====================
        
        async function loadCategories() {
            try {
                showLoadingInList('categories-list', 'æ­£åœ¨åŠ è½½å“ç±»ä¿¡æ¯...');
                
                const response = await fetch('/api/categories');
                const result = await response.json();
                
                if (result.success) {
                    currentCategories = normalizeLandingCategories(result.data || []);
                    displayCategoriesList(currentCategories);
                    console.log(`âœ… æˆåŠŸåŠ è½½ ${currentCategories.length} ä¸ªå“ç±»`);
                } else {
                    showErrorInList('categories-list', 'åŠ è½½å“ç±»æ•°æ®å¤±è´¥: ' + result.message);
                }
            } catch (error) {
                console.error('åŠ è½½å“ç±»æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯:', error);
                showErrorInList('categories-list', 'åŠ è½½å“ç±»æ•°æ®å¤±è´¥: ' + error.message);
            }
        }

        function displayCategoriesList(categories) {
            const container = document.getElementById('categories-list');
            
            if (categories.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <div>æš‚æ— å“ç±»æ•°æ®</div>
                        <div style="font-size: 0.85rem; margin-top: 0.5rem;">ç‚¹å‡»"æ–°å»ºå“ç±»"å¼€å§‹åˆ›å»º</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = categories.map(category => `
                <div class="list-item ${category._id === currentSelectedCategoryId ? 'active' : ''}" 
                     onclick="selectCategory('${category._id}')">
                    <div class="list-item-header">
                        <div class="list-item-title">${category.name}</div>
                        ${category.yield_percentage ? `<div class="list-item-badge">${category.yield_percentage}%</div>` : ''}
                    </div>
                    <div class="list-item-meta">
                        <div>${category.picking_period || 'é‡‡æ‘˜æœŸæœªè®¾å®š'}</div>
                        <div>${category.description ? category.description.substring(0, 30) + '...' : 'æš‚æ— æè¿°'}</div>
                    </div>
                    ${category.image_url ? `
                        <div class="list-item-preview">
                            <img src="${category.image_url}" class="preview-image" alt="${category.name}" 
                                 style="width: 100%; height: 80px; object-fit: cover; border-radius: 4px;" 
                                 onerror="this.style.display='none'">
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function selectCategory(categoryId) {
            const category = currentCategories.find(c => c._id === categoryId);
            if (!category) return;

            currentSelectedCategoryId = categoryId;
            currentCategoryImageUrl = category.image_url || '';

            // æ˜¾ç¤ºç¼–è¾‘å™¨
            document.getElementById('category-editor-empty').style.display = 'none';
            document.getElementById('category-editor-content').style.display = 'block';

            // æ›´æ–°æ ‡é¢˜å’Œè¡¨å•
            document.getElementById('category-editor-title').textContent = `ç¼–è¾‘å“ç±»ï¼š${category.name}`;
            document.getElementById('category-name').value = category.name;
            document.getElementById('category-description').value = category.description || '';
            document.getElementById('category-yield').value = category.yield_percentage || 0;
            document.getElementById('category-picking').value = category.picking_period || '';
            document.getElementById('category-sort-order').value = category.sort_order || 999;
            document.getElementById('category-image-url').value = category.image_url || '';

            // æ›´æ–°å›¾ç‰‡é¢„è§ˆ
            updateCategoryImagePreview();
            
            // æ›´æ–°åˆ—è¡¨é«˜äº®
            displayCategoriesList(currentCategories);
            
            console.log(`âœ… å·²é€‰æ‹©å“ç±»: ${category.name}`);
        }

        function updateCategoryImagePreview() {
            const container = document.getElementById('category-image-preview');
            const removeBtn = document.getElementById('remove-category-image-btn');
            
            if (currentCategoryImageUrl) {
                container.innerHTML = `
                    <img src="${currentCategoryImageUrl}" class="image-preview-large" alt="å“ç±»å›¾ç‰‡" 
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="image-placeholder" style="display: none;">å›¾ç‰‡åŠ è½½å¤±è´¥</div>
                `;
                removeBtn.style.display = 'inline-flex';
            } else {
                container.innerHTML = '<div class="image-placeholder">æš‚æ— å›¾ç‰‡</div>';
                removeBtn.style.display = 'none';
            }
        }

        function replaceCategoryImage() {
            document.getElementById('category-file-input').click();
        }

        function captureCategoryPhoto() {
            document.getElementById('category-camera-input').click();
        }

        function removeCategoryImage() {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™å¼ å›¾ç‰‡å—ï¼Ÿ')) {
                currentCategoryImageUrl = '';
                document.getElementById('category-image-url').value = '';
                updateCategoryImagePreview();
            }
        }

        async function uploadCategoryImage(file) {
            try {
                const formData = new FormData();
                formData.append('image', file);

                const response = await fetch('/api/upload-image', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    currentCategoryImageUrl = result.data.fullUrl;
                    document.getElementById('category-image-url').value = currentCategoryImageUrl;
                    updateCategoryImagePreview();
                    showSuccessAlert('å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼');
                } else {
                    showErrorAlert('å›¾ç‰‡ä¸Šä¼ å¤±è´¥: ' + result.message);
                }
            } catch (error) {
                console.error('ä¸Šä¼ å“ç±»å›¾ç‰‡æ—¶å‘ç”Ÿé”™è¯¯:', error);
                showErrorAlert('å›¾ç‰‡ä¸Šä¼ å¤±è´¥: ' + error.message);
            }
        }

        async function saveCategoryChanges() {
            if (!currentSelectedCategoryId) {
                alert('è¯·å…ˆé€‰æ‹©è¦ç¼–è¾‘çš„å“ç±»');
                return;
            }

            const name = document.getElementById('category-name').value.trim();
            if (!name) {
                alert('å“ç±»åç§°ä¸èƒ½ä¸ºç©º');
                return;
            }

            try {
                const response = await fetch(`/api/categories/${currentSelectedCategoryId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: name,
                        image_url: currentCategoryImageUrl || '',
                        description: document.getElementById('category-description').value.trim(),
                        yield_percentage: parseFloat(document.getElementById('category-yield').value) || 0,
                        picking_period: document.getElementById('category-picking').value.trim(),
                        sort_order: parseInt(document.getElementById('category-sort-order').value) || 999
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showSuccessAlert(`å“ç±»"${name}"æ›´æ–°æˆåŠŸï¼`);
                    await loadCategories();
                    selectCategory(currentSelectedCategoryId);
                } else {
                    showErrorAlert('æ›´æ–°å“ç±»å¤±è´¥: ' + result.message);
                }
            } catch (error) {
                console.error('ä¿å­˜å“ç±»æ›´æ”¹æ—¶å‘ç”Ÿé”™è¯¯:', error);
                showErrorAlert('ä¿å­˜å“ç±»æ›´æ”¹å¤±è´¥: ' + error.message);
            }
        }

        function resetCategoryEditor() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ›´æ”¹å—ï¼Ÿæœªä¿å­˜çš„ä¿®æ”¹å°†ä¸¢å¤±ã€‚')) {
                if (currentSelectedCategoryId) {
                    selectCategory(currentSelectedCategoryId);
                }
            }
        }

        async function createNewCategory() {
            const name = prompt('è¯·è¾“å…¥æ–°å“ç±»çš„åç§°:');
            if (!name || !name.trim()) return;

            try {
                const response = await fetch('/api/categories', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: name.trim(),
                        image_url: '',
                        description: '',
                        yield_percentage: 0,
                        picking_period: '',
                        sort_order: 999
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showSuccessAlert('æ–°å“ç±»åˆ›å»ºæˆåŠŸï¼');
                    await loadCategories();
                    selectCategory(result.data._id);
                } else {
                    showErrorAlert('åˆ›å»ºå“ç±»å¤±è´¥: ' + result.message);
                }
            } catch (error) {
                console.error('åˆ›å»ºå“ç±»æ—¶å‘ç”Ÿé”™è¯¯:', error);
                showErrorAlert('åˆ›å»ºå“ç±»å¤±è´¥: ' + error.message);
            }
        }

        async function deleteCategory() {
            if (!currentSelectedCategoryId) {
                alert('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„å“ç±»');
                return;
            }

            const category = currentCategories.find(c => c._id === currentSelectedCategoryId);
            if (!confirm(`ç¡®å®šè¦åˆ é™¤å“ç±»"${category.name}"å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`)) return;

            try {
                const response = await fetch(`/api/categories/${currentSelectedCategoryId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    showSuccessAlert('å“ç±»åˆ é™¤æˆåŠŸï¼');
                    document.getElementById('category-editor-content').style.display = 'none';
                    document.getElementById('category-editor-empty').style.display = 'block';
                    currentSelectedCategoryId = '';
                    await loadCategories();
                } else {
                    showErrorAlert('åˆ é™¤å“ç±»å¤±è´¥: ' + result.message);
                }
            } catch (error) {
                console.error('åˆ é™¤å“ç±»æ—¶å‘ç”Ÿé”™è¯¯:', error);
                showErrorAlert('åˆ é™¤å“ç±»å¤±è´¥: ' + error.message);
            }
        }

        // ==================== èƒŒæ™¯å›¾ç®¡ç†å‡½æ•° ====================
        
        async function loadSettings() {
            try {
                const response = await fetch('/api/settings/cta-background');
                const result = await response.json();
                
                if (result.success && result.data) {
                    currentCtaBackgroundUrl = result.data.value || '';
                    currentCtaDescription = result.data.description || '';
                    
                    document.getElementById('cta-background').value = currentCtaBackgroundUrl;
                    document.getElementById('setting-description').value = currentCtaDescription;
                    
                    updateCtaBackgroundPreview();
                    console.log('âœ… æˆåŠŸåŠ è½½èƒŒæ™¯å›¾è®¾ç½®');
                } else {
                    currentCtaBackgroundUrl = '';
                    currentCtaDescription = '';
                    updateCtaBackgroundPreview();
                }
            } catch (error) {
                console.error('åŠ è½½èƒŒæ™¯å›¾è®¾ç½®æ—¶å‘ç”Ÿé”™è¯¯:', error);
                showErrorAlert('åŠ è½½è®¾ç½®æ•°æ®å¤±è´¥: ' + error.message);
            }
        }

        function updateCtaBackgroundPreview() {
            const container = document.getElementById('cta-background-preview');
            const deleteBtn = document.getElementById('delete-cta-bg-btn');
            
            if (currentCtaBackgroundUrl) {
                container.innerHTML = `
                    <img src="${currentCtaBackgroundUrl}" class="image-preview-large" alt="CTAèƒŒæ™¯å›¾" 
                         style="max-height: 200px; width: 100%; object-fit: cover;"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="image-placeholder" style="display: none;">å›¾ç‰‡åŠ è½½å¤±è´¥</div>
                `;
                deleteBtn.style.display = 'inline-flex';
            } else {
                container.innerHTML = '<div class="image-placeholder" style="width: 100%; height: 200px;">æš‚æ— èƒŒæ™¯å›¾</div>';
                deleteBtn.style.display = 'none';
            }
        }

        function replaceCtaBackground() {
            document.getElementById('cta-file-input').click();
        }

        function captureCtaBackground() {
            document.getElementById('cta-camera-input').click();
        }

        function deleteCtaBackground() {
            if (confirm('ç¡®å®šè¦åˆ é™¤å½“å‰èƒŒæ™¯å›¾å—ï¼Ÿ')) {
                currentCtaBackgroundUrl = '';
                document.getElementById('cta-background').value = '';
                updateCtaBackgroundPreview();
            }
        }

        async function uploadCtaBackgroundImage(file) {
            try {
                const formData = new FormData();
                formData.append('image', file);

                const response = await fetch('/api/upload-image', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    currentCtaBackgroundUrl = result.data.fullUrl;
                    document.getElementById('cta-background').value = currentCtaBackgroundUrl;
                    updateCtaBackgroundPreview();
                    showSuccessAlert('èƒŒæ™¯å›¾ä¸Šä¼ æˆåŠŸï¼');
                } else {
                    showErrorAlert('èƒŒæ™¯å›¾ä¸Šä¼ å¤±è´¥: ' + result.message);
                }
            } catch (error) {
                console.error('ä¸Šä¼ èƒŒæ™¯å›¾æ—¶å‘ç”Ÿé”™è¯¯:', error);
                showErrorAlert('èƒŒæ™¯å›¾ä¸Šä¼ å¤±è´¥: ' + error.message);
            }
        }

        async function saveCtaBackground() {
            if (!currentCtaBackgroundUrl) {
                alert('è¯·å…ˆä¸Šä¼ èƒŒæ™¯å›¾ç‰‡');
                return;
            }

            try {
                const response = await fetch('/api/settings/cta-background', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        value: currentCtaBackgroundUrl,
                        description: document.getElementById('setting-description').value.trim() || 'äº‘å…»èŒ¶å›­CTAåŒºåŸŸèƒŒæ™¯å›¾'
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showSuccessAlert('èƒŒæ™¯å›¾è®¾ç½®ä¿å­˜æˆåŠŸï¼');
                    await loadSettings();
                } else {
                    showErrorAlert('ä¿å­˜è®¾ç½®å¤±è´¥: ' + result.message);
                }
            } catch (error) {
                console.error('ä¿å­˜èƒŒæ™¯å›¾è®¾ç½®æ—¶å‘ç”Ÿé”™è¯¯:', error);
                showErrorAlert('ä¿å­˜è®¾ç½®å¤±è´¥: ' + error.message);
            }
        }

        function resetCtaBackground() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ›´æ”¹å—ï¼Ÿæœªä¿å­˜çš„ä¿®æ”¹å°†ä¸¢å¤±ã€‚')) {
                loadSettings();
            }
        }

        // ==================== é¡µè„šç®¡ç†å‡½æ•° ====================
        
        async function loadFooterSettings() {
            try {
                const response = await fetch('/api/settings/footer');
                const result = await response.json();
                
                if (result.success) {
                    currentFooterData = result.data;
                    
                    document.getElementById('footer-garden-name').value = currentFooterData.gardenName || '';
                    document.getElementById('footer-copyright').value = currentFooterData.copyrightText || '';
                    document.getElementById('footer-logo-url').value = currentFooterData.logoUrl || '';
                    
                    updateFooterLogoPreview();
                    renderFooterSocialLinks();
                    displayFooterPreview();
                    
                    console.log('âœ… æˆåŠŸåŠ è½½é¡µè„šè®¾ç½®');
                } else {
                    showErrorAlert('åŠ è½½é¡µè„šè®¾ç½®å¤±è´¥: ' + result.message);
                }
            } catch (error) {
                console.error('åŠ è½½é¡µè„šè®¾ç½®æ—¶å‘ç”Ÿé”™è¯¯:', error);
                showErrorAlert('åŠ è½½é¡µè„šè®¾ç½®å¤±è´¥: ' + error.message);
            }
        }

        function updateFooterLogoPreview() {
            const container = document.getElementById('footer-logo-preview');
            const deleteBtn = document.getElementById('delete-footer-logo-btn');
            
            if (currentFooterData.logoUrl) {
                container.innerHTML = `
                    <img src="${currentFooterData.logoUrl}" class="image-preview-large" alt="é¡µè„šLogo" 
                         style="max-width: 200px; max-height: 100px;"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="image-placeholder" style="display: none;">LogoåŠ è½½å¤±è´¥</div>
                `;
                deleteBtn.style.display = 'inline-flex';
            } else {
                container.innerHTML = '<div class="image-placeholder" style="width: 200px; height: 100px;">æš‚æ— Logo</div>';
                deleteBtn.style.display = 'none';
            }
        }

        function uploadFooterLogo() {
            document.getElementById('footer-logo-file-input').click();
        }

        function captureFooterLogo() {
            document.getElementById('footer-logo-camera-input').click();
        }

        function deleteFooterLogo() {
            if (confirm('ç¡®å®šè¦åˆ é™¤é¡µè„šLogoå—ï¼Ÿ')) {
                currentFooterData.logoUrl = '';
                document.getElementById('footer-logo-url').value = '';
                updateFooterLogoPreview();
            }
        }

        async function uploadFooterLogoFile(file) {
            try {
                const formData = new FormData();
                formData.append('image', file);

                const response = await fetch('/api/upload-image', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    currentFooterData.logoUrl = result.data.fullUrl;
                    document.getElementById('footer-logo-url').value = currentFooterData.logoUrl;
                    updateFooterLogoPreview();
                    showSuccessAlert('Logoä¸Šä¼ æˆåŠŸï¼');
                } else {
                    showErrorAlert('Logoä¸Šä¼ å¤±è´¥: ' + result.message);
                }
            } catch (error) {
                console.error('ä¸Šä¼ Logoæ—¶å‘ç”Ÿé”™è¯¯:', error);
                showErrorAlert('Logoä¸Šä¼ å¤±è´¥: ' + error.message);
            }
        }

        function renderFooterSocialLinks() {
            const container = document.getElementById('footer-social-links-list');
            
            if (!currentFooterData.socialLinks || currentFooterData.socialLinks.length === 0) {
                container.innerHTML = '<div class="empty-state" style="padding: 2rem;">æš‚æ— ç¤¾äº¤é“¾æ¥ï¼Œä½¿ç”¨ä¸‹æ–¹è¡¨å•æ·»åŠ </div>';
                return;
            }

            container.innerHTML = currentFooterData.socialLinks.map((link, index) => `
                <div class="social-link-item">
                    <div class="social-platform">${platformNames[link.platform] || link.platform}</div>
                    <input type="text" class="form-control" value="${link.url}" 
                           onchange="updateFooterSocialLink(${index}, this.value)" 
                           placeholder="é“¾æ¥URL">
                    <button class="btn btn-danger btn-small" onclick="removeFooterSocialLink(${index})">åˆ é™¤</button>
                </div>
            `).join('');
        }

        function addFooterSocialLink() {
            const platformSelect = document.getElementById('footer-new-platform');
            const urlInput = document.getElementById('footer-new-url');
            
            const platform = platformSelect.value;
            const url = urlInput.value.trim();

            if (!platform) {
                alert('è¯·é€‰æ‹©ç¤¾äº¤å¹³å°');
                return;
            }

            if (!url) {
                alert('è¯·è¾“å…¥é“¾æ¥URL');
                return;
            }

            try {
                new URL(url);
            } catch (e) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„URLæ ¼å¼ï¼ˆéœ€è¦åŒ…å« http:// æˆ– https://ï¼‰');
                return;
            }

            const existingIndex = currentFooterData.socialLinks.findIndex(link => link.platform === platform);
            if (existingIndex !== -1) {
                if (confirm(`å·²å­˜åœ¨ ${platformNames[platform]} çš„é“¾æ¥ï¼Œæ˜¯å¦æ›¿æ¢ï¼Ÿ`)) {
                    currentFooterData.socialLinks[existingIndex].url = url;
                } else {
                    return;
                }
            } else {
                currentFooterData.socialLinks.push({ platform, url });
            }

            platformSelect.value = '';
            urlInput.value = '';
            renderFooterSocialLinks();
            displayFooterPreview();
        }

        function updateFooterSocialLink(index, newUrl) {
            if (currentFooterData.socialLinks[index]) {
                currentFooterData.socialLinks[index].url = newUrl.trim();
            }
        }

        function removeFooterSocialLink(index) {
            const link = currentFooterData.socialLinks[index];
            if (confirm(`ç¡®å®šè¦åˆ é™¤ ${platformNames[link.platform]} çš„é“¾æ¥å—ï¼Ÿ`)) {
                currentFooterData.socialLinks.splice(index, 1);
                renderFooterSocialLinks();
                displayFooterPreview();
            }
        }

        async function saveAllFooterSettings() {
            try {
                const footerData = {
                    logoUrl: currentFooterData.logoUrl || '',
                    gardenName: document.getElementById('footer-garden-name').value.trim(),
                    copyrightText: document.getElementById('footer-copyright').value.trim(),
                    socialLinks: currentFooterData.socialLinks
                };

                const response = await fetch('/api/settings/footer', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(footerData)
                });

                const result = await response.json();

                if (result.success) {
                    showSuccessAlert('æ‰€æœ‰é¡µè„šè®¾ç½®ä¿å­˜æˆåŠŸï¼');
                    currentFooterData = result.data;
                    displayFooterPreview();
                } else {
                    showErrorAlert('ä¿å­˜é¡µè„šè®¾ç½®å¤±è´¥: ' + result.message);
                }
            } catch (error) {
                console.error('ä¿å­˜é¡µè„šè®¾ç½®æ—¶å‘ç”Ÿé”™è¯¯:', error);
                showErrorAlert('ä¿å­˜é¡µè„šè®¾ç½®å¤±è´¥: ' + error.message);
            }
        }

        function displayFooterPreview() {
            const preview = document.getElementById('footer-preview');
            const content = document.getElementById('footer-preview-content');
            
            preview.style.display = 'block';
            content.innerHTML = `
                    ${currentFooterData.logoUrl ? `
                        <div style="margin-bottom: 1rem;">
                        <strong style="color: var(--tea-green-dark);">Logo:</strong><br>
                        <img src="${currentFooterData.logoUrl}" style="max-width: 120px; margin-top: 0.5rem; border: 1px solid var(--border-color); border-radius: 4px;" alt="Logoé¢„è§ˆ">
                        </div>
                    ` : '<p><strong>Logo:</strong> æœªè®¾ç½®</p>'}
                    
                <div class="preview-grid">
                    <div class="preview-item">
                        <strong>èŒ¶å›­åç§°</strong>
                        ${currentFooterData.gardenName || 'æœªè®¾ç½®'}
                    </div>
                    <div class="preview-item">
                        <strong>ç‰ˆæƒä¿¡æ¯</strong>
                        ${currentFooterData.copyrightText || 'æœªè®¾ç½®'}
                    </div>
                    <div class="preview-item">
                        <strong>ç¤¾äº¤é“¾æ¥</strong>
                        ${currentFooterData.socialLinks.length} ä¸ª
                    </div>
                </div>
                
                ${currentFooterData.socialLinks.length > 0 ? `
                    <div style="margin-top: 1rem;">
                        <strong style="color: var(--tea-green-dark); display: block; margin-bottom: 0.5rem;">ç¤¾äº¤é“¾æ¥åˆ—è¡¨:</strong>
                        ${currentFooterData.socialLinks.map((link, index) => `
                            <div style="padding: 0.5rem; background: var(--tea-cream); border-radius: 4px; margin-bottom: 0.5rem; font-size: 0.85rem;">
                                <strong>${index + 1}. ${platformNames[link.platform]}:</strong>
                                <a href="${link.url}" target="_blank" style="color: var(--tea-green); word-break: break-all;">${link.url}</a>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
            `;
        }

        // ==================== æ–‡ä»¶è¾“å…¥åˆå§‹åŒ– ====================
        
        function initFileInputs() {
            // åœ°å—å›¾ç‰‡
            document.getElementById('plot-file-input').addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    if (currentReplaceImageIndex !== null) {
                        // æ›¿æ¢æ¨¡å¼
                        uploadPlotImage(e.target.files[0], currentReplaceImageIndex);
                        currentReplaceImageIndex = null;
                    } else {
                        // æ·»åŠ æ¨¡å¼
                        uploadPlotImage(e.target.files[0]);
                    }
                }
                e.target.value = '';
            });

            document.getElementById('plot-camera-input').addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    uploadPlotImage(e.target.files[0]);
                }
                e.target.value = '';
            });

            // å“ç±»å›¾ç‰‡
            document.getElementById('category-file-input').addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    uploadCategoryImage(e.target.files[0]);
                }
                e.target.value = '';
            });

            document.getElementById('category-camera-input').addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    uploadCategoryImage(e.target.files[0]);
                }
                e.target.value = '';
            });

            // CTAèƒŒæ™¯å›¾
            document.getElementById('cta-file-input').addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    uploadCtaBackgroundImage(e.target.files[0]);
                }
                e.target.value = '';
            });

            document.getElementById('cta-camera-input').addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    uploadCtaBackgroundImage(e.target.files[0]);
                }
                e.target.value = '';
            });

            // é¡µè„šLogo
            document.getElementById('footer-logo-file-input').addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    uploadFooterLogoFile(e.target.files[0]);
                }
                e.target.value = '';
            });
            
            document.getElementById('footer-logo-camera-input').addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    uploadFooterLogoFile(e.target.files[0]);
                }
                e.target.value = '';
            });
        }

        // ==================== å·¥å…·å‡½æ•° ====================
        
        function showLoadingInList(containerId, message = 'æ­£åœ¨åŠ è½½...') {
            document.getElementById(containerId).innerHTML = `
                <div class="empty-state">
                    <div class="spinner" style="width: 40px; height: 40px; margin: 0 auto 1rem;"></div>
                    <div>${message}</div>
                </div>
            `;
        }

        function showErrorInList(containerId, message) {
            document.getElementById(containerId).innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">âš ï¸</div>
                    <div style="color: var(--error);">${message}</div>
                </div>
            `;
        }

        function showSuccessAlert(message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-success';
            alertDiv.innerHTML = `
                <span style="font-size: 1.2rem;">âœ…</span>
                <span>${message}</span>
            `;
            
            document.body.appendChild(alertDiv);
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '10000';
            alertDiv.style.maxWidth = '400px';
            
            setTimeout(() => {
                alertDiv.style.opacity = '0';
                setTimeout(() => alertDiv.remove(), 300);
            }, 3000);
        }

        function showErrorAlert(message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-error';
            alertDiv.innerHTML = `
                <span style="font-size: 1.2rem;">âŒ</span>
                <span>${message}</span>
            `;
            
            document.body.appendChild(alertDiv);
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '10000';
            alertDiv.style.maxWidth = '400px';
            
            setTimeout(() => {
                alertDiv.style.opacity = '0';
                setTimeout(() => alertDiv.remove(), 300);
            }, 5000);
        }

        // ç¦»å¼€é¡µé¢å‰çš„æç¤ºï¼ˆå¦‚æœæœ‰æœªä¿å­˜çš„æ›´æ”¹ï¼‰
        window.addEventListener('beforeunload', function(e) {
            // è¿™é‡Œå¯ä»¥æ·»åŠ æ£€æŸ¥æ˜¯å¦æœ‰æœªä¿å­˜çš„æ›´æ”¹çš„é€»è¾‘
            // æš‚æ—¶æ³¨é‡Šæ‰ï¼Œé¿å…æ¯æ¬¡éƒ½æç¤º
            // e.preventDefault();
            // e.returnValue = '';
        });
    </script>
</body>
</html>
